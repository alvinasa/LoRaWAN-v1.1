对于支持B类终端设备的网络，所有网关必须同步广播一个信标，为终端设备提供定时参考。基于此定时参考，终端设备可以周期性地打开接收窗口，此后称为“ping时隙”，其可以由网络基础设施用来发起下行链路通信。使用这些ping槽之一发起的下行链路网络称为“ping”。网络服务器根据终端设备最后一个上行链路的信号质量指标选择发起该下行链路通信的网关。因此，如果终端设备移动并检测到接收到的信标中通知的身份发生变化，则必须向网络服务器发送上行链路，以便服务器可以更新下行链路路由路径数据库。

_在设备可以以B类模式运行之前，以下信息必须提供给网络服务器带外使用。_

* _设备的默认ping时隙周期_
* _默认的Ping时隙数据速率_
* _默认的Ping时隙信道_

所有终端设备作为A类终端设备启动并加入网络。然后终端设备应用可以决定切换到B类。这通过以下过程完成：

* 终端设备应用请求LoRaWAN层切换到B类模式。如果找到并锁定了网络信标或BEACON\_NOT\_FOUND服务原语，则终端设备中的LoRaWAN层将搜索信标并返回BEACON\_LOCKED服务原语到应用。为了加速信标发现，LoRaWAN层可以使用“DeviceTimeReq”MAC命令。
* 一旦处于B类模式，MAC层将每个发送的上行链路帧的FCTRL字段的_B类_位设置为1。该位通知服务器设备已切换到B类。MAC层将自动调度每个信标和每个ping时隙的接收时隙。当信标接收成功时，终端设备LoRaWAN层将信标内容与测量的无线信号强度一起转发给应用。终端设备LoRaWAN层考虑到信标接收时隙和时隙调度中的最大可能时钟漂移。当在ping时隙期间成功解调下行链路时，如LoRaWAN A类规范中所述，其处理与下行链路类似。
* 移动终端设备必须定期通知网络服务器其位置以更新下行链路路由。这是通过发送一个正常（可能是空的）“未确认”或“确认”上行链路来完成的。终端设备LoRaWAN层将在帧的FCtrl字段中将_B类_位适当地设置为1。如果应用通过分析信标内容检测到节点正在移动，最佳情况下可以更高效地完成此操作。在这种情况下，终端设备必须应用随机延迟（如15.5节中定义的信标接收和上行链路传输之间的时间，以避免系统上行链路冲突）。
* 在任何时候，网络服务器都可以通过发送PingSlotChannelReq MAC命令来更改设备的ping时隙下行链路频率或数据速率。
* 设备可以随时更改其ping时隙的周期性。为此，它必须暂时停止B类操作（在其上行链路帧中未设置classB位），并向网络服务器发送PingSlotInfoReq。一旦确认该命令，设备就可以用新的ping时隙周期重新启动classB操作。
* 如果在给定的时间段内没有收到信标（如第12.2节中定义），则与网络的同步丢失。MAC层必须通知应用层它已经切换回A类。因此，终端设备LoRaWAN层停止设置所有上行链路中的_B类_位，并通知网络服务器终端设备不再处于B类模式。终端设备应用程序可以尝试定期切换回B类。这将从信标搜索开始重启此过程。

下图说明了信标接收时隙和ping时隙的概念。

![](/assets/Figure 50: Beacon reception slot and ping slots.png)

在本例中，如果信标周期为128s，则终端设备每32s打开一个ping接收时隙。大多数情况下，服务器并未使用该ping时隙，因此只要无线收发器评估无线信道上不存在前导码，终端设备接收窗口就会关闭。如果检测到前导码，则无线收发器将保持开启直到下行链路帧被解调。然后MAC层将处理该帧，检查其地址字段是否与终端设备地址相匹配，并在将其转发到应用层之前，消息完整性检查有效。

