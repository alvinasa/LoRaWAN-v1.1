# 11 下行Ping帧格式（B类可选）

## 11.1 物理帧格式

下行链路Ping使用与A类下行链路帧相同的格式，但可能遵循不同的信道频率规划。

## 11.2 单播和组播MAC消息

消息可以是“单播”或“组播”。单播消息被发送到单个终端设备，组播消息被发送到多个终端设备。组播组的所有设备必须共享相同的组播地址和相关的加密密钥。LoRaWAN Class B规范没有规定如何远程设置这样的组播组或者安全地分发所需的组播密钥材料。这必须在节点个性化期间或通过应用层执行。

### 11.2.1 单播MAC消息格式

单播下行链路**Ping**的MAC有效载荷使用A类规范中定义的格式。它由终端设备以完全相同的方式进行处理。无论下行链路是使用Class B ping时隙还是Class A“piggy-back”时隙，都使用相同的帧计数器并递增。

### 11.2.2 组播MAC消息格式

组播帧共享大部分单播帧格式，但有一些例外：

* 它们不允许携带MAC命令，既不在**FOpt**字段中，也不在端口0的有效载荷中携带，因为组播下行链路不具有与单播帧相同的身份验证鲁棒性。
* **ACK**和**ADRACKReq**位必须为零。**MType**字段必须包含未确认的数据下行的值。
* **FPending**位指示有更多的组播数据要发送。如果它被设置，下一个组播接收时隙将携带数据帧。如果未设置，则下一个时隙可能会或可能不会携带数据。终端设备可以使用此位来评估冲突接收时隙的优先级。

